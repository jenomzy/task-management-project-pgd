<div class="input-group mt-3 mb-3">
    <input type="text" id="searchInput" class="form-control" placeholder="Search for users...">
</div>
<br>
<button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#registermember">
    Register New Member
</button>
<button class="w3-button w3-xlarge w3-circle w3-black" data-bs-toggle="modal"
    data-bs-target="#registermember">+</button>

<button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#pdmember">
    Promote/Demote Member
</button>
<button class="w3-button w3-xlarge w3-circle w3-black" data-bs-toggle="modal" data-bs-target="#pdmember">+</button>

<br><br>

<!-- Managers Table -->
<div class="w3-responsive">
    <h2>Managers</h2>
    <table class="w3-table-all w3-card-4" id="managersTable">
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Phone No.</th>
            </tr>
        </thead>
        <tbody>
            {{#each managers as |manager|}}
            <tr>
                <td>{{manager.fname}}</td>
                <td>{{manager.lname}}</td>
                <td>{{manager.username}}</td>
                <td>{{manager.phone}}</td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>

<!-- Other Users Table -->
<div class="w3-responsive">
    <h2>Other Users</h2>
    <table class="w3-table-all w3-card-4" id="otherUsersTable">
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Phone No.</th>
                <th>Current Position</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {{#each otherUsers as |user|}}
            <tr>
                <td>{{user.fname}}</td>
                <td>{{user.lname}}</td>
                <td>{{user.username}}</td>
                <td>{{user.phone}}</td>
                <td>{{user.position}}</td>
                <td>
                    <div class="btn-group">
                        <a href="/edit-user/{{user._id}}" class="btn btn-primary">Edit</a>
                        <a href="/view-projects/{{user._id}}" class="btn btn-info">View Projects</a>
                    </div>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>




<!-- The Register Member Modal -->
<div class="modal fade" id="registermember">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">New Member Registration</h4>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <form method="post" action="/register" autocomplete="off">
                    <div class="row">
                        <div class="col input-group input-group-lg mb-3">
                            <input type="text" class="form-control" placeholder="Enter first name" name="fname"
                                required>
                        </div>
                        <div class="col input-group input-group-lg mb-3">
                            <input type="text" class="form-control" placeholder="Enter last name" name="lname" required>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col input-group input-group-lg mb-3">
                            <input type="email" class="form-control" placeholder="Enter email" name="email" required>
                        </div>
                        <div class="col input-group input-group-lg mb-3">
                            <input type="text" class="form-control" placeholder="Enter Password" name="pswd">
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col input-group input-group-lg mb-3">
                            <input type="text" pattern="[0-9]+" class="form-control" placeholder="Enter Phone Number"
                                name="phoneno" required>
                        </div>
                        <div class="col input-group input-group-lg mb-3">
                            <select class="form-select" name="position">
                                <option name="teamm" value="teamm">Team member</option>
                                <option name="teaml" value="teaml">Team Leader</option>
                                <option name="mm" value="mm">Manager</option>
                            </select>
                        </div>
                    </div>
                    <br><br><br>
                    <button type="submit" class="btn btn-primary"
                        onclick="return confirm('Are you sure you want to Register this user?');">Submit
                        Data</button>
                </form>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

<!-- The Promote/Demote Member Modal -->
<div class="modal fade" id="pdmember">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Role Re-assignment</h4>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <!-- Tabs for Promote and Demote Forms -->
                <ul class="nav nav-tabs" id="tabMenu" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="promote-tab" data-bs-toggle="tab" data-bs-target="#promote"
                            type="button" role="tab" aria-controls="promote" aria-selected="true">Promote Member to
                            Leader</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="demote-tab" data-bs-toggle="tab" data-bs-target="#demote"
                            type="button" role="tab" aria-controls="demote" aria-selected="false">Demote Leader to
                            Member</button>
                    </li>
                </ul>

                <!-- Tab panes for Promote and Demote Forms -->
                <div class="tab-content" id="tabContent">
                    <div class="tab-pane fade show active" id="promote" role="tabpanel" aria-labelledby="promote-tab">
                        <form id="promoteForm" action="/promote" method="POST">
                            <label for="memberSelect" class="form-label">Select Member to Promote:</label>
                            <select id="memberSelect" name="userId" class="form-select" required>
                                {{#each teamMembers}}
                                <option value="{{_id}}">{{fname}} {{lname}}</option>
                                {{/each}}
                            </select>
                            <button type="submit" class="btn btn-primary mt-3"
                                onclick="return confirm('Are you sure you want to promote this user?');">Promote to
                                Leader</button>
                        </form>
                    </div>
                    <div class="tab-pane fade" id="demote" role="tabpanel" aria-labelledby="demote-tab">
                        <form id="demoteForm" action="/demote" method="POST">
                            <label for="leaderSelect" class="form-label">Select Leader to Demote:</label>
                            <select id="leaderSelect" name="userId" class="form-select" required>
                                {{#each teamLeaders}}
                                <option value="{{_id}}">{{fname}} {{lname}}</option>
                                {{/each}}
                            </select>
                            <button type="submit" class="btn btn-danger mt-3"
                                onclick="return confirm('Are you sure you want to demote this user?');">Demote to
                                Member</button>
                        </form>
                    </div>
                </div>

            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#searchInput').on('keyup', function () {
            var value = $(this).val().toLowerCase();
            // Search both manager and other user tables
            $('#managersTable tbody tr, #otherUsersTable tbody tr').filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        });
    });
</script>